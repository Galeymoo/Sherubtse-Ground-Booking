<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ground Booking</title>
  <link rel="stylesheet" href="/css/styles.css"/>
  <link rel="stylesheet" href="/css/my-bookings.css"/>
  <style>
    .tabs { display: flex; gap: 1rem; margin-bottom: 1rem; }
    .tab { padding: 0.5rem 1rem; cursor: pointer; border: 1px solid #ccc; border-radius: 5px; }
    .tab.active { background: #007bff; color: white; }
    .table-card { display: none; }
    .table-card.active { display: block; }
    .overlay-form { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000; }
    .overlay-form.active { display: flex; }
    .overlay-content { background: white; padding: 2rem; border-radius: 8px; width: 300px; }
    .overlay-actions { display: flex; justify-content: space-between; margin-top: 1rem; }
    .cancel { background: red; color: white; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 0.75rem; border: 1px solid #ccc; text-align: center; }
    .status-approved { color: green; }
    .status-rejected { color: red; }
    .status-pending { color: orange; }
  </style>
</head>
<body>
  <%- include('Partials/header') %>

  <main class="main-wrapper">
    <div class="content">

      <!-- Tabs -->
      <div class="tabs">
        <div class="tab active" data-tab="available">Available Ground Slots</div>
        <div class="tab" data-tab="booked">All Booked Slots</div>
      </div>

      <!-- Available Slots Table -->
      <div class="table-card active" id="available">
        <h3>Available Ground Slots</h3>

        <% if (availableSlots.length > 0) { %>
          <table>
            <thead>
              <tr>
                <th>Day</th>
                <th>Start</th>
                <th>End</th>
                <th>Book Slot</th>
              </tr>
            </thead>
            <tbody>
              <% availableSlots.forEach(slot => { %>
                <tr>
                  <td><%= slot.day %></td>
                  <td><%= new Date(slot.startTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }) %></td>
                  <td><%= new Date(slot.endTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }) %></td>
                  <td>
                    <button onclick="toggleForm('<%= slot.id %>')">Book</button>

                    <!-- Overlay Form -->
                    <div class="overlay-form" id="form-<%= slot.id %>">
                      <div class="overlay-content">
                        <form action="/booking/book/<%= slot.id %>" method="POST">
                          <h4>Book Slot</h4>
                          <input type="text" name="name" placeholder="Your Name" value="<%= user?.name || '' %>" required />
                          <input type="text" name="course" placeholder="Course" value="<%= user?.course || '' %>" required />
                          <input type="text" name="year" placeholder="Year" value="<%= user?.year || '' %>" required />
                          <div class="overlay-actions">
                            <button type="submit">Submit</button>
                            <button type="button" class="cancel" onclick="toggleForm('<%= slot.id %>')">Cancel</button>
                          </div>
                        </form>
                      </div>
                    </div>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } else { %>
          <p>No ground slots are available at this time.</p>
        <% } %>
      </div>

      <!-- Booked Slots Table -->
      <div class="table-card" id="booked">
        <h3>All Booked Slots</h3>
        <% if (bookedSlots.length > 0) { %>
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Course</th>
                <th>Year</th>
                <th>Day</th>
                <th>Start</th>
                <th>End</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <% bookedSlots.forEach(b => { %>
                <tr>
                  <td><%= b.name %></td>
                  <td><%= b.course %></td>
                  <td><%= b.year %></td>
                  <td><%= b.GroundSlot?.day || 'N/A' %></td>
                  <td><%= new Date(b.GroundSlot?.startTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }) || 'N/A' %></td>
                  <td><%= new Date(b.GroundSlot?.endTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }) || 'N/A' %></td>
                  <td class="status-<%= b.status.toLowerCase() %>"><%= b.status %></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } else { %>
          <p>No bookings found yet.</p>
        <% } %>
      </div>

    </div>
  </main>

  <%- include('Partials/footer') %>

  <script>
    function toggleForm(slotId) {
      const form = document.getElementById('form-' + slotId);
      if (form) form.classList.toggle('active');
    }

    // Tab switching logic
    const tabs = document.querySelectorAll('.tab');
    const tables = document.querySelectorAll('.table-card');

    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tables.forEach(table => table.classList.remove('active'));

        tab.classList.add('active');
        document.getElementById(tab.dataset.tab).classList.add('active');
      });
    });
  </script>
</body>
</html>

